# Полный анализ проекта "CAV"

## 1. Обзор архитектуры
- API-сервер Express (`server/server.js:1`) проксирует общие пути (`/api/auth`, `/api/contact`, `/api/portfolio`, `/api/partners`, `/api/ai-chat`) и маршрутизирует остальные запросы через `server/api/uuid.js:1`, где реализовано правило `/:uuid`.
- UUID-ы сопоставлены с функциями в `backend/func2url.json:1`; для большего числа эндпоинтов проксирование делегируется на локальный сервис Gatevey (`proxyToGatevey`).
- Бэкенд представляет собой набор независимых функций в папке `backend/`; каждая из них обслуживает конкретный бизнес-кейс (от логирования админов до обработки RSS и интеграций с внешними API).

## 2. UUID и функции
- Все 27 UUID-ов перечислены в `backend/func2url.json:1`, включая генерацию новостей, аналитики, загрузку изображений, управление портфолио и администраторские операции.
- `server/api/uuid.js:1` добавляет кастомные обработчики (`handleAuthAdmin`, `handleBotLog`, `handleNewsCreate`, `handleSecureSettings` и др.) для тех UUID-ов, которыми управляет сам сервер.
- Проксирование выставлено на последовательность `POST|PUT|PATCH|DELETE`, чтобы сторонние функции запускались напрямую через Gatevey (`proxyToGatevey`).

## 3. План тестирования (сводка)
- **Unit-тесты**: критично покрыть валидацию входных данных и настройку внешних зависимостей (`postgres`, `boto3`, `telegram`, `OpenAI`). See individual files in `plans/recommendations/` for details (например, `plans/recommendations/track-visit.md`).
- **Integration-тесты**: каждый сервис должен проверять OPTIONS/GET/POST-методы, работу с БД и сторонними API (Bitrix24, Telegram, Yandex API, Ollama, S3). См. `plans/recommendations/*.md`.
- **E2E**: сценарии, которые запускают цепочку взаимодействий (напр. заполняется форма и выполняется отправка Bitrix24 + Telegram) и проверяют, что подсистемы работают вместе.
- **Нагрузочное**: ключевые функции, особенно логирование (`track-visit`, `bot-logger`, `bot-stats`) и `submit-order`, требуют тестов на 50–100 запросов в секунду и устойчивости к отказу БД/Telegram/API.

## 4. Общие рекомендации
- Безопасность: включить аутентификацию/rate limiting для каждого админского эндпойнта (`plans/recommendations/*-admin*.md`), убрать хранение паролей в открытом виде (`backend/partners/index.py:144`).
- Производительность: внедрить connection pooling (`psycopg2`), кэширование (Redis) и индексы на поля дат/статуса во всех функциях, упомянутых в `plans/recommendations/*.md`.
- Мониторинг и логирование: добавить метрики и alerts в наиболее критичных местах (`auth-admin`, `bot-logger`, `secure-settings`, `services-admin`).

## 5. Резюме по функциям
Каждая детализированная рекомендация находится в отдельных файлах внутри `plans/recommendations/` (например, [`plans/recommendations/seo-analyze.md`](plans/recommendations/seo-analyze.md:1)). Следует пройтись по списку и применить приоритеты (аннотированные уровни критичности в каждом файле).

## 6. Следующие шаги
1. Автоматизировать сбор метрик и ленивую загрузку через connection pooling/Redis.
2. Завершить аудит безопасности, реализовав rate limiting + аутентификацию для всех UUID-обработчиков (`server/api/uuid.js:59`).
3. Развернуть план тестирования во внешнем CI (unit/integration + нагрузка).
4. Поддерживать каталог рекомендаций `plans/recommendations/` в актуальном состоянии для новых функций.
