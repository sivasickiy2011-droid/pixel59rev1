# План исправления функций news-feed и portfolio

## Текущее состояние

### news-feed
- Функция `backend/news-feed/index.py` работает, но перевод не выполняется из-за отсутствия переменных окружения `YANDEX_TRANSLATE_API_KEY` и `YANDEX_TRANSLATE_FOLDER_ID`.
- В коде есть fallback: если переменные отсутствуют, текст возвращается без перевода.
- Есть прокси Ollama на порту 3003 (`server/ollama-proxy.js`), но не используется в news-feed.
- Компонент новостей на фронтенде (`src/components/News.tsx`) уже существует и использует эндпоинт `/api/265f74c3-c0a3-4d44-b005-9119dff641cf`.

### portfolio
- Таблица `portfolio` существует в схеме `public`, но код бекенда ожидает таблицу `t_p26695620_cav_bitrix_portfolio.portfolio_projects`.
- Структура таблицы отличается: в коде ожидаются поля `carousel_image_url`, `preview_image_url`, `website_url`, `display_order`, но в БД есть `project_url`, `technologies`, `sort_order`.
- Компонент портфолио на фронтенде (`src/components/Portfolio.tsx`) использует эндпоинт `/api/99ddd15c-93b5-4d9e-8536-31e6f6630304`.
- В таблице есть 2 тестовые записи без изображений.

## Проблемы

1. **news-feed**: перевод не работает из-за отсутствия API ключей Yandex Translate.
2. **portfolio**: несоответствие схемы таблицы приводит к пустому ответу (нет данных).

## Решения

### 1. Исправление news-feed
**Вариант A**: Добавить переменные окружения YANDEX_TRANSLATE_API_KEY и YANDEX_TRANSLATE_FOLDER_ID в secure_settings.
**Вариант B**: Интегрировать Ollama для перевода (предпочтительно, так как уже есть прокси).

### 2. Исправление portfolio
**Вариант A**: Изменить код бекенда, чтобы использовать таблицу `public.portfolio` с маппингом полей.
**Вариант B**: Создать таблицу `t_p26695620_cav_bitrix_portfolio.portfolio_projects` с нужной структурой и перенести данные.

## Детальный план действий

### Этап 1: Настройка перевода новостей через Ollama
1. Проверить доступность Ollama на `172.16.57.77:11434`.
2. Модифицировать `backend/news-feed/index.py`:
   - Добавить функцию перевода через Ollama API.
   - Использовать эндпоинт `http://localhost:3003/api/ollama/v1/chat/completions` или напрямую `172.16.57.77:11434`.
   - Добавить fallback на Yandex Translate.
3. Обновить `requirements.txt` для news-feed (добавить `requests` если нужно).
4. Протестировать получение новостей с переводом.

### Этап 2: Исправление portfolio
1. Создать SQL миграцию для приведения таблицы к ожидаемой структуре:
   ```sql
   ALTER TABLE portfolio RENAME COLUMN project_url TO website_url;
   ALTER TABLE portfolio ADD COLUMN carousel_image_url TEXT;
   ALTER TABLE portfolio ADD COLUMN preview_image_url TEXT;
   ALTER TABLE portfolio RENAME COLUMN sort_order TO display_order;
   ALTER TABLE portfolio DROP COLUMN technologies;
   ```
2. Или создать новую таблицу в нужной схеме и скопировать данные.
3. Обновить код бекенда `backend/portfolio/index.py`:
   - Исправить SQL запросы на использование правильных имен столбцов.
   - Убедиться, что запрос возвращает все необходимые поля.
4. Добавить несколько тестовых проектов с изображениями для проверки карусели.

### Этап 3: Тестирование
1. Проверить, что news-feed возвращает переведенные новости.
2. Проверить, что portfolio возвращает проекты с изображениями.
3. Убедиться, что фронтенд компоненты корректно отображают данные.

### Этап 4: Документация
1. Обновить README или документацию по настройке окружения.
2. Добавить инструкции по добавлению проектов в портфолио через админку.

## Приоритеты
1. Исправить portfolio для отображения проектов в карусели.
2. Настроить перевод новостей через Ollama.
3. Добавить тестовые данные для демонстрации.

## Ожидаемый результат
- Новости будут переводиться на русский язык (через Ollama или Yandex).
- Портфолио будет показывать проекты с изображениями и корректными данными.
- Оба компонента будут работать на главной странице.

## Следующие шаги
1. Перейти в режим Code для реализации изменений.
2. Согласовать план с пользователем.