# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≠—Ç–∞–ø–∞ 4: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CSS

**–≠—Ç–∞–ø:** 4 –∏–∑ 5  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –î–æ 200,000 —Ç–æ–∫–µ–Ω–æ–≤  
**–ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:** `stage1-results.md`, `stage2-results.md`, `stage3-results.md`

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤
1. **–≠—Ç–∞–ø 1:** –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å BEM-–∫–ª–∞—Å—Å–∞–º–∏
2. **–≠—Ç–∞–ø 2:** Backend API endpoints
3. **–≠—Ç–∞–ø 3:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫ CSS —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ–∫—É—â–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/components/admin/`
- **–†–æ—É—Ç–∏–Ω–≥:** `/admin/*`
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:** –°–æ–≥–ª–∞—Å–∏—è, –ü–∞—Ä—Ç–Ω—ë—Ä—ã, –ö–æ–Ω—Ç–µ–Ω—Ç, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **Layout:** `AdminLayout.tsx`

---

## üéØ –ó–∞–¥–∞—á–∞ —ç—Ç–∞–ø–∞

–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è CSS —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

### –ü–æ–¥–∑–∞–¥–∞—á–∏:
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è CSS
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫–∞—Ç–∞
6. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```
/admin/css-management
‚îú‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ (–ª–µ–≤–∞—è –ø–∞–Ω–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫
‚îÇ   ‚îî‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –±–ª–æ–∫–æ–≤
‚îú‚îÄ‚îÄ –†–µ–¥–∞–∫—Ç–æ—Ä (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª–æ–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ Monaco Editor
‚îÇ   ‚îú‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è
‚îî‚îÄ‚îÄ –ü—Ä–µ–≤—å—é/–ò—Å—Ç–æ—Ä–∏—è (–ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å)
    ‚îú‚îÄ‚îÄ –í–∫–ª–∞–¥–∫–∞ "–ü—Ä–µ–≤—å—é"
    ‚îî‚îÄ‚îÄ –í–∫–ª–∞–¥–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è"
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îî‚îÄ‚îÄ CSSManagement.tsx         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îî‚îÄ‚îÄ css/
‚îÇ           ‚îú‚îÄ‚îÄ CSSBlockList.tsx      # –°–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤
‚îÇ           ‚îú‚îÄ‚îÄ CSSBlockCard.tsx      # –ö–∞—Ä—Ç–æ—á–∫–∞ –±–ª–æ–∫–∞
‚îÇ           ‚îú‚îÄ‚îÄ CSSEditor.tsx         # –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
‚îÇ           ‚îú‚îÄ‚îÄ CSSPreview.tsx        # –ü—Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ           ‚îú‚îÄ‚îÄ CSSHistory.tsx        # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ           ‚îî‚îÄ‚îÄ CSSBlockForm.tsx      # –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–ª–æ–∫–∞
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îî‚îÄ‚îÄ useCSSManagement.ts       # Hook –¥–ª—è API
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ css.ts                        # TypeScript —Ç–∏–ø—ã
```

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –§–∞–π–ª: `src/types/css.ts`

```typescript
export interface CSSBlock {
  id: number;
  block_name: string;
  component_name: string;
  css_content: string;
  is_active: boolean;
  priority: number;
  created_at: string;
  updated_at: string;
  created_by: string;
  description: string;
}

export interface CSSHistoryEntry {
  id: number;
  block_id: number;
  css_content_before: string;
  css_content_after: string;
  changed_by: string;
  changed_at: string;
  change_description: string;
}

export interface CSSBlockFormData {
  block_name: string;
  component_name: string;
  css_content: string;
  is_active: boolean;
  priority: number;
  description: string;
}
```

### –§–∞–π–ª: `src/hooks/admin/useCSSManagement.ts`

```typescript
import { useState, useCallback } from 'react';
import axios from 'axios';
import { CSSBlock, CSSHistoryEntry, CSSBlockFormData } from '@/types/css';

const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://pixel59.ru/api';

export const useCSSManagement = () => {
  const [blocks, setBlocks] = useState<CSSBlock[]>([]);
  const [selectedBlock, setSelectedBlock] = useState<CSSBlock | null>(null);
  const [history, setHistory] = useState<CSSHistoryEntry[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const getAuthHeaders = () => ({
    Authorization: `Bearer ${localStorage.getItem('admin_auth')}`,
  });

  /**
   * –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –±–ª–æ–∫–∏
   */
  const fetchBlocks = useCallback(async (filters?: { component?: string; active?: boolean }) => {
    setIsLoading(true);
    setError(null);
    try {
      const params = new URLSearchParams();
      if (filters?.component) params.append('component', filters.component);
      if (filters?.active !== undefined) params.append('active', String(filters.active));

      const response = await axios.get<{ blocks: CSSBlock[] }>(
        `${API_BASE_URL}/css-blocks?${params}`,
        { headers: getAuthHeaders() }
      );
      setBlocks(response.data.blocks);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch blocks');
    } finally {
      setIsLoading(false);
    }
  }, []);

  /**
   * –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–ª–æ–∫ –ø–æ ID
   */
  const fetchBlock = useCallback(async (id: number) => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await axios.get<{ block: CSSBlock }>(
        `${API_BASE_URL}/css-blocks/${id}`,
        { headers: getAuthHeaders() }
      );
      setSelectedBlock(response.data.block);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch block');
    } finally {
      setIsLoading(false);
    }
  }, []);

  /**
   * –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±–ª–æ–∫
   */
  const createBlock = useCallback(async (data: CSSBlockFormData) => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await axios.post<{ block: CSSBlock }>(
        `${API_BASE_URL}/css-blocks`,
        data,
        { headers: getAuthHeaders() }
      );
      await fetchBlocks();
      return response.data.block;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to create block');
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [fetchBlocks]);

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫
   */
  const updateBlock = useCallback(async (id: number, data: Partial<CSSBlockFormData>) => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await axios.put<{ block: CSSBlock }>(
        `${API_BASE_URL}/css-blocks/${id}`,
        data,
        { headers: getAuthHeaders() }
      );
      await fetchBlocks();
      setSelectedBlock(response.data.block);
      return response.data.block;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to update block');
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [fetchBlocks]);

  /**
   * –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫
   */
  const deleteBlock = useCallback(async (id: number) => {
    setIsLoading(true);
    setError(null);
    try {
      await axios.delete(
        `${API_BASE_URL}/css-blocks/${id}`,
        { headers: getAuthHeaders() }
      );
      await fetchBlocks();
      if (selectedBlock?.id === id) {
        setSelectedBlock(null);
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to delete block');
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [fetchBlocks, selectedBlock]);

  /**
   * –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
   */
  const fetchHistory = useCallback(async (blockId: number) => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await axios.get<{ history: CSSHistoryEntry[] }>(
        `${API_BASE_URL}/css-blocks/${blockId}/history`,
        { headers: getAuthHeaders() }
      );
      setHistory(response.data.history);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch history');
    } finally {
      setIsLoading(false);
    }
  }, []);

  /**
   * –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
   */
  const rollbackChanges = useCallback(async (blockId: number, historyId: number) => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await axios.post<{ block: CSSBlock }>(
        `${API_BASE_URL}/css-blocks/${blockId}/rollback/${historyId}`,
        {},
        { headers: getAuthHeaders() }
      );
      await fetchBlocks();
      setSelectedBlock(response.data.block);
      await fetchHistory(blockId);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to rollback changes');
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [fetchBlocks, fetchHistory]);

  return {
    blocks,
    selectedBlock,
    history,
    isLoading,
    error,
    fetchBlocks,
    fetchBlock,
    createBlock,
    updateBlock,
    deleteBlock,
    fetchHistory,
    rollbackChanges,
    setSelectedBlock,
  };
};
```

### –§–∞–π–ª: `src/components/admin/css/CSSEditor.tsx`

```typescript
import { useState, useEffect } from 'react';
import Editor from '@monaco-editor/react';
import { Button } from '@/components/ui/button';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { CSSBlock } from '@/types/css';
import { Save, X, Eye, History } from 'lucide-react';

interface CSSEditorProps {
  block: CSSBlock | null;
  onSave: (data: Partial<CSSBlock>) => Promise<void>;
  onCancel: () => void;
  onShowPreview: () => void;
  onShowHistory: () => void;
}

const CSSEditor: React.FC<CSSEditorProps> = ({
  block,
  onSave,
  onCancel,
  onShowPreview,
  onShowHistory,
}) => {
  const [cssContent, setCssContent] = useState('');
  const [isActive, setIsActive] = useState(true);
  const [priority, setPriority] = useState(0);
  const [description, setDescription] = useState('');
  const [isSaving, setIsSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  useEffect(() => {
    if (block) {
      setCssContent(block.css_content);
      setIsActive(block.is_active);
      setPriority(block.priority);
      setDescription(block.description || '');
      setHasChanges(false);
    }
  }, [block]);

  const handleSave = async () => {
    if (!block) return;
    
    setIsSaving(true);
    try {
      await onSave({
        css_content: cssContent,
        is_active: isActive,
        priority,
        description,
      });
      setHasChanges(false);
    } finally {
      setIsSaving(false);
    }
  };

  const handleEditorChange = (value: string | undefined) => {
    setCssContent(value || '');
    setHasChanges(true);
  };

  if (!block) {
    return (
      <div className="flex items-center justify-center h-full text-gray-500">
        –í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      </div>
    );
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="p-4 border-b border-gray-700 bg-gray-800">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h3 className="text-lg font-semibold text-white">{block.block_name}</h3>
            <p className="text-sm text-gray-400">{block.component_name}</p>
          </div>
          <div className="flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={onShowPreview}
              className="text-gray-300"
            >
              <Eye className="w-4 h-4 mr-2" />
              –ü—Ä–µ–≤—å—é
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={onShowHistory}
              className="text-gray-300"
            >
              <History className="w-4 h-4 mr-2" />
              –ò—Å—Ç–æ—Ä–∏—è
            </Button>
          </div>
        </div>

        {/* Settings */}
        <div className="grid grid-cols-3 gap-4">
          <div className="flex items-center space-x-2">
            <Switch
              id="is-active"
              checked={isActive}
              onCheckedChange={(checked) => {
                setIsActive(checked);
                setHasChanges(true);
              }}
            />
            <Label htmlFor="is-active" className="text-gray-300">
              –ê–∫—Ç–∏–≤–µ–Ω
            </Label>
          </div>
          
          <div>
            <Label htmlFor="priority" className="text-gray-300 text-xs">
              –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
            </Label>
            <Input
              id="priority"
              type="number"
              value={priority}
              onChange={(e) => {
                setPriority(parseInt(e.target.value) || 0);
                setHasChanges(true);
              }}
              className="mt-1 bg-gray-900 text-white border-gray-700"
            />
          </div>

          <div>
            <Label htmlFor="description" className="text-gray-300 text-xs">
              –û–ø–∏—Å–∞–Ω–∏–µ
            </Label>
            <Input
              id="description"
              value={description}
              onChange={(e) => {
                setDescription(e.target.value);
                setHasChanges(true);
              }}
              placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
              className="mt-1 bg-gray-900 text-white border-gray-700"
            />
          </div>
        </div>
      </div>

      {/* Editor */}
      <div className="flex-1 overflow-hidden">
        <Editor
          height="100%"
          defaultLanguage="css"
          value={cssContent}
          onChange={handleEditorChange}
          theme="vs-dark"
          options={{
            minimap: { enabled: false },
            fontSize: 14,
            lineNumbers: 'on',
            scrollBeyondLastLine: false,
            automaticLayout: true,
            tabSize: 2,
            wordWrap: 'on',
          }}
        />
      </div>

      {/* Footer */}
      <div className="p-4 border-t border-gray-700 bg-gray-800 flex items-center justify-between">
        <div className="text-sm text-gray-400">
          {hasChanges && '‚óè –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è'}
        </div>
        <div className="flex gap-2">
          <Button
            variant="outline"
            onClick={onCancel}
            disabled={isSaving}
          >
            <X className="w-4 h-4 mr-2" />
            –û—Ç–º–µ–Ω–∞
          </Button>
          <Button
            onClick={handleSave}
            disabled={!hasChanges || isSaving}
            className="bg-blue-600 hover:bg-blue-700"
          >
            <Save className="w-4 h-4 mr-2" />
            {isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}
          </Button>
        </div>
      </div>
    </div>
  );
};

export default CSSEditor;
```

### –§–∞–π–ª: `src/pages/admin/CSSManagement.tsx`

```typescript
import { useEffect, useState } from 'react';
import { useCSSManagement } from '@/hooks/admin/useCSSManagement';
import AdminLayout from '@/components/AdminLayout';
import CSSBlockList from '@/components/admin/css/CSSBlockList';
import CSSEditor from '@/components/admin/css/CSSEditor';
import CSSPreview from '@/components/admin/css/CSSPreview';
import CSSHistory from '@/components/admin/css/CSSHistory';
import { Button } from '@/components/ui/button';
import { Plus } from 'lucide-react';
import { toast } from 'sonner';

type ViewMode = 'editor' | 'preview' | 'history';

const CSSManagement = () => {
  const {
    blocks,
    selectedBlock,
    history,
    isLoading,
    error,
    fetchBlocks,
    fetchBlock,
    updateBlock,
    deleteBlock,
    fetchHistory,
    rollbackChanges,
    setSelectedBlock,
  } = useCSSManagement();

  const [viewMode, setViewMode] = useState<ViewMode>('editor');
  const [searchQuery, setSearchQuery] = useState('');
  const [filterComponent, setFilterComponent] = useState<string>('');

  useEffect(() => {
    fetchBlocks();
  }, [fetchBlocks]);

  useEffect(() => {
    if (selectedBlock && viewMode === 'history') {
      fetchHistory(selectedBlock.id);
    }
  }, [selectedBlock, viewMode, fetchHistory]);

  const handleSelectBlock = async (blockId: number) => {
    await fetchBlock(blockId);
    setViewMode('editor');
  };

  const handleSave = async (data: Partial<typeof selectedBlock>) => {
    if (!selectedBlock) return;
    
    try {
      await updateBlock(selectedBlock.id, data);
      toast.success('CSS –±–ª–æ–∫ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
    } catch (err) {
      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–ª–æ–∫–∞');
    }
  };

  const handleDelete = async (blockId: number) => {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫?')) return;
    
    try {
      await deleteBlock(blockId);
      toast.success('CSS –±–ª–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
    } catch (err) {
      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–ª–æ–∫–∞');
    }
  };

  const handleRollback = async (historyId: number) => {
    if (!selectedBlock) return;
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?')) return;
    
    try {
      await rollbackChanges(selectedBlock.id, historyId);
      toast.success('–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–∞—á–µ–Ω—ã');
      setViewMode('editor');
    } catch (err) {
      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π');
    }
  };

  const filteredBlocks = blocks.filter(block => {
    const matchesSearch = block.block_name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         block.component_name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesComponent = !filterComponent || block.component_name === filterComponent;
    return matchesSearch && matchesComponent;
  });

  const components = Array.from(new Set(blocks.map(b => b.component_name))).sort();

  return (
    <AdminLayout>
      <div className="h-[calc(100vh-8rem)]">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-bold text-white">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CSS</h1>
            <p className="text-gray-400 mt-1">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
            </p>
          </div>
          <Button className="bg-blue-600 hover:bg-blue-700">
            <Plus className="w-4 h-4 mr-2" />
            –°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫
          </Button>
        </div>

        <div className="grid grid-cols-12 gap-4 h-[calc(100%-5rem)]">
          {/* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ */}
          <div className="col-span-3 bg-gray-800 rounded-lg overflow-hidden flex flex-col">
            <CSSBlockList
              blocks={filteredBlocks}
              selectedBlockId={selectedBlock?.id}
              onSelectBlock={handleSelectBlock}
              onDeleteBlock={handleDelete}
              searchQuery={searchQuery}
              onSearchChange={setSearchQuery}
              filterComponent={filterComponent}
              onFilterChange={setFilterComponent}
              components={components}
              isLoading={isLoading}
            />
          </div>

          {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å - —Ä–µ–¥–∞–∫—Ç–æ—Ä */}
          <div className="col-span-6 bg-gray-800 rounded-lg overflow-hidden">
            <CSSEditor
              block={selectedBlock}
              onSave={handleSave}
              onCancel={() => setSelectedBlock(null)}
              onShowPreview={() => setViewMode('preview')}
              onShowHistory={() => setViewMode('history')}
            />
          </div>

          {/* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –ø—Ä–µ–≤—å—é/–∏—Å—Ç–æ—Ä–∏—è */}
          <div className="col-span-3 bg-gray-800 rounded-lg overflow-hidden">
            {viewMode === 'preview' ? (
              <CSSPreview
                block={selectedBlock}
                onClose={() => setViewMode('editor')}
              />
            ) : viewMode === 'history' ? (
              <CSSHistory
                history={history}
                onRollback={handleRollback}
                onClose={() => setViewMode('editor')}
                isLoading={isLoading}
              />
            ) : (
              <div className="flex items-center justify-center h-full text-gray-500">
                <div className="text-center">
                  <Eye className="w-12 h-12 mx-auto mb-2 opacity-50" />
                  <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–≤—å—é –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—é</p>
                </div>
              </div>
            )}
          </div>
        </div>

        {error && (
          <div className="mt-4 p-4 bg-red-900/20 border border-red-700 rounded-lg text-red-400">
            {error}
          </div>
        )}
      </div>
    </AdminLayout>
  );
};

export default CSSManagement;
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Monaco Editor –¥–ª—è React
npm install @monaco-editor/react

# –ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - CodeMirror
npm install @uiw/react-codemirror @codemirror/lang-css
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ä–æ—É—Ç–∏–Ω–≥

```typescript
// src/App.tsx –∏–ª–∏ router config

import CSSManagement from '@/pages/admin/CSSManagement';

// –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç:
<Route path="/admin/css-management" element={<CSSManagement />} />
```

### –û–±–Ω–æ–≤–∏—Ç—å AdminLayout.tsx

```typescript
// src/components/AdminLayout.tsx

const navItems = [
  { path: '/admin/consents', label: '–°–æ–≥–ª–∞—Å–∏—è', icon: FileCheck },
  { path: '/admin/partners', label: '–ü–∞—Ä—Ç–Ω—ë—Ä—ã', icon: Users },
  { path: '/admin/content', label: '–ö–æ–Ω—Ç–µ–Ω—Ç', icon: FolderKanban },
  { path: '/admin/css-management', label: 'CSS', icon: Palette }, // –ù–û–í–´–ô
  { path: '/admin/analytics', label: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ SEO', icon: BarChart3 },
  { path: '/admin/security', label: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', icon: ShieldCheck },
];
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- [ ] –°–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–µ–≤—å—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### UI/UX:
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–µ–Ω
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- [ ] –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å
- [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –†–æ—É—Ç–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

---

## üìÑ –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `stage4-results.md`:

```markdown
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠—Ç–∞–ø–∞ 4: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CSS

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ CSSManagement.tsx - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ CSSBlockList.tsx - –°–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤
- ‚úÖ CSSBlockCard.tsx - –ö–∞—Ä—Ç–æ—á–∫–∞ –±–ª–æ–∫–∞
- ‚úÖ CSSEditor.tsx - –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
- ‚úÖ CSSPreview.tsx - –ü—Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ CSSHistory.tsx - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ CSSBlockForm.tsx - –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### –•—É–∫–∏
- ‚úÖ useCSSManagement.ts - API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –†–æ—É—Ç /admin/css-management –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –ü—Ä–µ–≤—å—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏ –æ—Ç–∫–∞—Ç —Ä–∞–±–æ—Ç–∞—é—Ç

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
–ü–µ—Ä–µ—Ö–æ–¥ –∫ –≠—Ç–∞–ø—É 5: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

**–°—Ç–∞—Ç—É—Å:** üöÄ –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–º–ø—Ç:** `05-stage5-prompt.md`  
**–¢—Ä–µ–±—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:** `stage1-results.md`, `stage2-results.md`, `stage3-results.md`
