# Исправление news-feed и portfolio

## Проблемы
1. **news-feed** не работал из-за отсутствия модуля feedparser и отсутствия перевода новостей.
2. **portfolio** возвращал пустой массив из-за неправильного маппинга UUID и неверной схемы таблицы.
3. Карусель portfolio не отображала данные из-за отсутствия тестовых проектов.

## Решения

### 1. Исправление маппинга UUID
- Обновлен `python-gatevey/main.py`: исправлен `UUID_MAPPING` для соответствия `func2url.json`.
- Теперь запросы к `/api/99ddd15c-93b5-4d9e-8536-31e6f6630304` направляются в `backend/portfolio/index.py`, а `/api/265f74c3-c0a3-4d44-b005-9119dff641cf` — в `backend/news-feed/index.py`.

### 2. Исправление схемы таблицы portfolio
- Таблица `public.portfolio` уже существует с колонками `id, title, description, image_url, project_url, technologies, sort_order, is_active, created_at, updated_at`.
- Исправлен SQL-запрос в `backend/portfolio/index.py` для выборки из `public.portfolio` с использованием алиасов, соответствующих ожидаемому фронтендом формату.
- Добавлены два тестовых проекта через прямой SQL INSERT.

### 3. Установка зависимостей news-feed
- Установлен модуль `feedparser` глобально: `pip install feedparser`.
- После установки эндпоинт news-feed начал возвращать новости из RSS-источников (web.dev, css-tricks).

### 4. Интеграция Ollama для перевода
- Проверена доступность Ollama по адресу `http://172.16.57.77:11434`. Модель `deepseek-coder:6.7b` доступна.
- В `backend/news-feed/index.py` добавлена функция `translate_via_ollama(text)`, которая отправляет запрос к Ollama через прокси `http://localhost:3003/api/ollama/translate`.
- Прокси реализован в `server/ollama-proxy.js` и перенаправляет запросы к Ollama API.
- Перевод пока не включён в основной поток из-за необходимости оптимизации производительности, но функция готова к использованию.

### 5. Тестирование эндпоинтов
- **portfolio GET**: `curl http://localhost:3002/api/99ddd15c-93b5-4d9e-8536-31e6f6630304` возвращает массив проектов.
- **news-feed GET**: `curl http://localhost:3002/api/265f74c3-c0a3-4d44-b005-9119dff641cf` возвращает новости на английском (перевод пока не применяется).

### 6. Фронтенд компоненты
- Компонент `Portfolio.tsx` использует тот же UUID и должен отображать карусель с проектами.
- Компонент `News.tsx` (если существует) должен отображать новости.
- Для проверки карусели достаточно двух тестовых проектов, но можно добавить больше через административный интерфейс.

## Оставшиеся задачи
1. **Активация перевода новостей**: необходимо модифицировать `backend/news-feed/index.py`, чтобы вызывать `translate_via_ollama` для заголовков и описаний, возможно с кэшированием.
2. **Добавление изображений для проектов**: обновить тестовые проекты с реальными изображениями через административный интерфейс или прямой SQL (требуется запись в БД).
3. **Удаление проекта**: функция `delete_project` в portfolio использует старую схему таблицы, нужно обновить.

## Инструкции по запуску
1. Убедитесь, что python-gatevey запущен: `cd python-gatevey && python3 main.py`.
2. Убедитесь, что Ollama работает: `curl http://172.16.57.77:11434/api/tags`.
3. Фронтенд запускается через `npm run dev`.

## Файлы изменений
- `python-gatevey/main.py`
- `backend/portfolio/index.py`
- `backend/news-feed/index.py`
- `server/ollama-proxy.js`
- `docs/news_feed_portfolio_fix.md` (этот файл)

Дата: 2026-01-19
