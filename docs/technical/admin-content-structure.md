# Структура панели управления контентом

## 2026-01-21T20:32:00Z — до
- `ContentAdmin` экспортирует четыре вкладки (`NewsAdmin`, `ServicesAdmin`, `PartnerLogosAdmin`, `PortfolioAdmin`) без дополнительной загрузочной логики и без гарантий на формат ответа API.
- `NewsAdmin`` занимает более 300 строк: внутри него находятся заглушки для хука загрузки, отрисовки карточек и модального окна, а также логика CRUD. Такое сосредоточение мешает выделить переиспользуемые куски (например, список, туллбар, хук загрузки).
- `PartnersAdmin` не проверял, что сервер вернул массив логотипов, и отправлял запросы без `X-Admin-Token`, полагаясь на implicit локальное хранилище.

## После
- Декомпозиция: `NewsAdmin` теперь рассматривается как агрегатор, который использует `useToast`, `requireAdminAuthHeaders`, отдельный `NewsSelectionBar` и `NewsAdminActions`. Мы фиксируем ошибки API, если ответ не массив, и оставляем крючки (`openModal`, `handleBulkDelete`) для последующего разбора на `NewsCardList`, `NewsCardItem`, `useNewsCards`. Это облегчает тестирование и повторное использование подсистем (например, `useNewsCards` можно применять в планировщике асинхронной загрузки).
- `PartnersAdmin` теперь работает строго с `requireAdminAuthHeaders`, валидацией payload и фолбэком, если API возвращает не массив. Это гарантирует, что `PartnerCard` и `PartnerForm` всегда получают валидные данные, а на случай ошибки показывается уведомление.
- `PortfolioAdmin` и фронтовый прокси (`python-gatevey/main.py`, `server/api/uuid.js`) теперь корректно проксируют тело DELETE-запросов (см. `ContentAdmin` вкладка «Портфолио») и логируют payload. Это упрощает поддержку API на стороне CentOS 9, где backend ожидает ID в JSON, а не querystring.

## Выгоды
1. Повышается тестируемость: контекст `requireAdminAuthHeaders` и `useToast` можно мокать, а `NewsAdmin` очевидно разбивается на `NewsCardList`/`NewsCardItem`, которые легче покрыть vitestом.
2. Повторное использование: отдельный хук загрузки новостей упрощает добавление обновления по расписанию, а модальные окна/панели действий делегированы `NewsSelectionBar` и `NewsAdminActions`.
3. Прогнозируемость: backend имеет строгое API (JSON DELETE) и фронт отправляет токены, поэтому можно планировать миграцию вместо `e.map` ошибок.
