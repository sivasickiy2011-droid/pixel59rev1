# üì¶ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É —Å–∞–π—Ç–∞ centerai.tech

## üéØ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ 24 backend —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤—Å—ë!

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- ‚úÖ 24 backend —Ñ—É–Ω–∫—Ü–∏–∏ (Python)
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (10 —Ç–∞–±–ª–∏—Ü, ~200 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- ‚úÖ 19 —Å–µ–∫—Ä–µ—Ç–æ–≤ (API –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏)
- ‚úÖ Frontend (React SPA)

---

## üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ backend —Ñ—É–Ω–∫—Ü–∏–π

| ‚Ññ | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|---|---------|------------|-------------|----------------|
| 1 | **track-visit** | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π | üî¥ | analytics.ts |
| 2 | **get-analytics** | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ | üî¥ | OwnStatsTab.tsx |
| 3 | **seo-analyze** | AI-–∞–Ω–∞–ª–∏–∑ SEO | üü° | SeoTab.tsx |
| 4 | **seo-apply** | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SEO | üü° | SeoTab.tsx |
| 5 | **bot-logger** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–æ–≤ | üü° | BotProtection.tsx |
| 6 | **bot-stats** | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–æ–≤ | üü¢ | BotAdmin.tsx |
| 7 | **password-manager** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è–º–∏ | üî¥ | ChangePassword.tsx |
| 8 | **upload-image** | –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3 | üî¥ | PortfolioImageUploader.tsx, LogoAdmin.tsx |
| 9 | **brief-handler** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—Ä–∏—Ñ–æ–≤ | üü° | Brief.tsx |
| 10 | **secure-settings** | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ë–î | üî¥ | useSecureSettings.ts |
| 11 | **contact-form** | –§–æ—Ä–º–∞ —Å–≤—è–∑–∏ ‚Üí Bitrix24 + Telegram | üî¥ | ContactModal.tsx |
| 12 | **services-admin** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏ | üü° | ServicesAdmin.tsx |
| 13 | **yandex-metrika-stats** | –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ API | üü¢ | Analytics.tsx |
| 14 | **yandex-webmaster-issues** | –Ø–Ω–¥–µ–∫—Å.–í–µ–±–º–∞—Å—Ç–µ—Ä | üü¢ | Analytics.tsx |
| 15 | **portfolio** | CRUD –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ | üî¥ | PortfolioAdmin.tsx |
| 16 | **admin-partner-logos** | –õ–æ–≥–æ—Ç–∏–ø—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ | üü° | PartnersAdmin.tsx |
| 17 | **partners** | CRUD –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ | üü° | Partners.tsx, PartnersCarousel.tsx |
| 18 | **partner-auth** | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ | üü° | PartnerContext.tsx |
| 19 | **submit-order** | –ó–∞–∫–∞–∑—ã ‚Üí Bitrix24 + Telegram | üî¥ | OrderModal.tsx |
| 20 | **admin-login-logs** | –õ–æ–≥–∏ –≤—Ö–æ–¥–æ–≤ | üü° | LoginHistory.tsx |
| 21 | **auth-admin** | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤ | üî¥ | AdminLogin.tsx |
| 22 | **consent** | –°–æ–≥–ª–∞—Å–∏—è GDPR | üü° | ConsentAdmin.tsx, CookieConsent.tsx |
| 23 | **news-feed** | –ù–æ–≤–æ—Å—Ç–∏ | üü¢ | News.tsx |

**–ò—Ç–æ–≥–æ:** 24 —Ñ—É–Ω–∫—Ü–∏–∏, –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚úÖ

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –¢–∞–±–ª–∏—Ü—ã (10 —à—Ç—É–∫):

1. **admin_login_logs** ‚Äî 70 –∑–∞–ø–∏—Å–µ–π
   - –õ–æ–≥–∏ –≤—Ö–æ–¥–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `admin-login-logs`, `auth-admin`

2. **bot_logs** ‚Äî 46 –∑–∞–ø–∏—Å–µ–π
   - –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –±–æ—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `bot-logger`, `bot-stats`

3. **daily_stats** ‚Äî 1 –∑–∞–ø–∏—Å—å
   - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `get-analytics`

4. **partner_logos** ‚Äî 5 –∑–∞–ø–∏—Å–µ–π
   - –õ–æ–≥–æ—Ç–∏–ø—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `admin-partner-logos`

5. **partners** ‚Äî 1 –∑–∞–ø–∏—Å—å
   - –î–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `partners`, `partner-auth`

6. **portfolio_projects** ‚Äî 11 –∑–∞–ø–∏—Å–µ–π
   - –ü—Ä–æ–µ–∫—Ç—ã –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `portfolio`

7. **secure_settings** ‚Äî 8 –∑–∞–ø–∏—Å–µ–π
   - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `secure-settings`

8. **services** ‚Äî 17 –∑–∞–ø–∏—Å–µ–π
   - –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `services-admin`

9. **site_visits** ‚Äî 25 –∑–∞–ø–∏—Å–µ–π
   - –ü–æ—Å–µ—â–µ–Ω–∏—è —Å–∞–π—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `track-visit`, `get-analytics`

10. **user_consents** ‚Äî 12 –∑–∞–ø–∏—Å–µ–π
    - –°–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç: `consent`

---

## üîê –°–µ–∫—Ä–µ—Ç—ã (19 —à—Ç—É–∫)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

1. **DATABASE_URL** üî¥
   - PostgreSQL connection string
   - –§–æ—Ä–º–∞—Ç: `postgresql://user:pass@host:port/database`

2. **AWS_ACCESS_KEY_ID** üî¥
   - –ö–ª—é—á S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

3. **AWS_SECRET_ACCESS_KEY** üî¥
   - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á S3

4. **S3_BUCKET_NAME** üî¥
   - –ò–º—è –±–∞–∫–µ—Ç–∞ (—Å–µ–π—á–∞—Å: `files`)

5. **S3_ENDPOINT_URL** üî¥
   - URL S3 (—Å–µ–π—á–∞—Å: `https://bucket.poehali.dev`)

6. **S3_REGION** üî¥
   - –†–µ–≥–∏–æ–Ω S3 (–Ω–∞–ø—Ä–∏–º–µ—Ä: `ru-central1`)

7. **ADMIN_PASSWORD_HASH** üî¥
   - Bcrypt —Ö–µ—à –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞

8. **ENCRYPTION_KEY** üî¥
   - –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `secure_settings`
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: `python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"`

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

9. **BITRIX24_WEBHOOK_URL** üü°
   - Webhook Bitrix24 CRM

10. **TELEGRAM_BOT_TOKEN** üü°
    - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞

11. **TELEGRAM_CHAT_ID** üü°
    - ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

12. **OPENAI_API_KEY** üü°
    - API –∫–ª—é—á OpenAI (–¥–ª—è SEO –∞–Ω–∞–ª–∏–∑–∞)

13. **OPENAI_API_BASE** üü°
    - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π endpoint OpenAI

14-19. **SMTP_*, YANDEX_*** üü¢
    - Email –∏ –Ø–Ω–¥–µ–∫—Å —Å–µ—Ä–≤–∏—Å—ã (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Ubuntu 20.04+ / CentOS 7+ / Debian 11+
- RAM: –º–∏–Ω–∏–º—É–º 2GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4GB
- Disk: –º–∏–Ω–∏–º—É–º 20GB SSD
- Python 3.11+
- PostgreSQL 13+
- Nginx 1.18+

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# Python 3.11
sudo apt install python3.11 python3.11-venv python3-pip -y

# PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# Nginx
sudo apt install nginx -y

# Certbot –¥–ª—è SSL
sudo apt install certbot python3-certbot-nginx -y
```

---

### –®–∞–≥ 2: –ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ poehali.dev:
```bash
# –î–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump "postgresql://user:pass@host:port/db" > database_backup.sql
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –í–æ–π—Ç–∏ –≤ PostgreSQL
sudo -u postgres psql

# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—É
CREATE USER centerai_user WITH PASSWORD 'strong_password_here';
CREATE DATABASE centerai_db OWNER centerai_user;
GRANT ALL PRIVILEGES ON DATABASE centerai_db TO centerai_user;
\q

# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–º–ø
psql -U centerai_user -d centerai_db < database_backup.sql
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```sql
psql -U centerai_user -d centerai_db

\dt  -- –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT 'admin_login_logs' as table, count(*) FROM admin_login_logs UNION ALL
SELECT 'bot_logs', count(*) FROM bot_logs UNION ALL
SELECT 'daily_stats', count(*) FROM daily_stats UNION ALL
SELECT 'partner_logos', count(*) FROM partner_logos UNION ALL
SELECT 'partners', count(*) FROM partners UNION ALL
SELECT 'portfolio_projects', count(*) FROM portfolio_projects UNION ALL
SELECT 'secure_settings', count(*) FROM secure_settings UNION ALL
SELECT 'services', count(*) FROM services UNION ALL
SELECT 'site_visits', count(*) FROM site_visits UNION ALL
SELECT 'user_consents', count(*) FROM user_consents;
```

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### –í–∞—Ä–∏–∞–Ω—Ç A: Yandex Object Storage
```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç –≤ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ
# 2. –ü–æ–ª—É—á–∏—Ç—å access_key –∏ secret_key
# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø

# 4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
aws s3 sync s3://old-bucket s3://new-bucket --region ru-central1
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Self-hosted MinIO
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MinIO
wget https://dl.min.io/server/minio/release/linux-amd64/minio
chmod +x minio
sudo mv minio /usr/local/bin/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
export MINIO_ROOT_USER=admin
export MINIO_ROOT_PASSWORD=your_password
minio server /data --console-address ":9001"
```

---

### –®–∞–≥ 4: –î–µ–ø–ª–æ–π backend —Ñ—É–Ω–∫—Ü–∏–π

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
/var/www/backend/
‚îú‚îÄ‚îÄ track-visit/
‚îÇ   ‚îú‚îÄ‚îÄ index.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ   ‚îî‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ get-analytics/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ ... (–≤—Å–µ 24 —Ñ—É–Ω–∫—Ü–∏–∏)
```

#### –°–æ–∑–¥–∞–Ω–∏–µ WSGI wrapper –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
```python
# /var/www/backend/track-visit/wsgi.py
import json
import os
from index import handler

def application(environ, start_response):
    method = environ.get('REQUEST_METHOD', 'GET')
    path = environ.get('PATH_INFO', '/')
    query_string = environ.get('QUERY_STRING', '')
    
    try:
        request_body_size = int(environ.get('CONTENT_LENGTH', 0))
    except ValueError:
        request_body_size = 0
    
    request_body = environ['wsgi.input'].read(request_body_size).decode('utf-8')
    
    event = {
        'httpMethod': method,
        'path': path,
        'queryStringParameters': dict(x.split('=') for x in query_string.split('&') if x),
        'headers': {k[5:].replace('_', '-').lower(): v 
                   for k, v in environ.items() if k.startswith('HTTP_')},
        'body': request_body,
        'isBase64Encoded': False
    }
    
    class Context:
        request_id = 'local-' + os.urandom(8).hex()
        function_name = 'track-visit'
        function_version = '1.0'
        memory_limit_in_mb = 256
    
    response = handler(event, Context())
    
    status = str(response.get('statusCode', 200)) + ' OK'
    headers = [(k, v) for k, v in response.get('headers', {}).items()]
    
    start_response(status, headers)
    return [response.get('body', '').encode('utf-8')]
```

#### Systemd service –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏:
```ini
# /etc/systemd/system/backend-track-visit.service
[Unit]
Description=Backend: track-visit
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/backend/track-visit
Environment="PATH=/var/www/backend/track-visit/venv/bin"
EnvironmentFile=/var/www/backend/track-visit/.env
ExecStart=/var/www/backend/track-visit/venv/bin/gunicorn --workers 2 --bind 127.0.0.1:8001 wsgi:application

[Install]
WantedBy=multi-user.target
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –≤—Å–µ—Ö 24 —Ñ—É–Ω–∫—Ü–∏–π:
```bash
#!/bin/bash
# deploy_all_functions.sh

FUNCTIONS=(
  "track-visit:8001"
  "get-analytics:8002"
  "seo-analyze:8003"
  "seo-apply:8004"
  "bot-logger:8005"
  "bot-stats:8006"
  "password-manager:8007"
  "upload-image:8008"
  "brief-handler:8009"
  "secure-settings:8010"
  "contact-form:8011"
  "services-admin:8012"
  "yandex-metrika-stats:8013"
  "yandex-webmaster-issues:8014"
  "portfolio:8015"
  "admin-partner-logos:8016"
  "partners:8017"
  "partner-auth:8018"
  "submit-order:8019"
  "admin-login-logs:8020"
  "auth-admin:8021"
  "consent:8022"
  "news-feed:8023"
)

for func_port in "${FUNCTIONS[@]}"; do
  IFS=':' read -r func port <<< "$func_port"
  
  echo "=== Deploying $func on port $port ==="
  
  cd /var/www/backend/$func
  
  # –°–æ–∑–¥–∞—Ç—å venv
  python3.11 -m venv venv
  source venv/bin/activate
  pip install -r requirements.txt gunicorn
  deactivate
  
  # –°–æ–∑–¥–∞—Ç—å systemd service
  cat > /etc/systemd/system/backend-$func.service <<EOF
[Unit]
Description=Backend: $func
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/backend/$func
Environment="PATH=/var/www/backend/$func/venv/bin"
EnvironmentFile=/var/www/backend/$func/.env
ExecStart=/var/www/backend/$func/venv/bin/gunicorn --workers 2 --bind 127.0.0.1:$port wsgi:application

[Install]
WantedBy=multi-user.target
EOF

  # –ó–∞–ø—É—Å—Ç–∏—Ç—å
  systemctl daemon-reload
  systemctl enable backend-$func
  systemctl start backend-$func
  
  echo "‚úÖ $func deployed on port $port"
done

echo ""
echo "‚úÖ All 24 functions deployed successfully!"
```

---

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```nginx
# /etc/nginx/sites-available/centerai.tech

# Upstream –¥–ª—è –≤—Å–µ—Ö 24 —Ñ—É–Ω–∫—Ü–∏–π
upstream backend_track_visit { server 127.0.0.1:8001; }
upstream backend_get_analytics { server 127.0.0.1:8002; }
upstream backend_seo_analyze { server 127.0.0.1:8003; }
upstream backend_seo_apply { server 127.0.0.1:8004; }
upstream backend_bot_logger { server 127.0.0.1:8005; }
upstream backend_bot_stats { server 127.0.0.1:8006; }
upstream backend_password_manager { server 127.0.0.1:8007; }
upstream backend_upload_image { server 127.0.0.1:8008; }
upstream backend_brief_handler { server 127.0.0.1:8009; }
upstream backend_secure_settings { server 127.0.0.1:8010; }
upstream backend_contact_form { server 127.0.0.1:8011; }
upstream backend_services_admin { server 127.0.0.1:8012; }
upstream backend_yandex_metrika { server 127.0.0.1:8013; }
upstream backend_yandex_webmaster { server 127.0.0.1:8014; }
upstream backend_portfolio { server 127.0.0.1:8015; }
upstream backend_partner_logos { server 127.0.0.1:8016; }
upstream backend_partners { server 127.0.0.1:8017; }
upstream backend_partner_auth { server 127.0.0.1:8018; }
upstream backend_submit_order { server 127.0.0.1:8019; }
upstream backend_admin_logs { server 127.0.0.1:8020; }
upstream backend_auth_admin { server 127.0.0.1:8021; }
upstream backend_consent { server 127.0.0.1:8022; }
upstream backend_news_feed { server 127.0.0.1:8023; }

server {
    listen 80;
    server_name centerai.tech www.centerai.tech;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name centerai.tech www.centerai.tech;
    
    # SSL (Let's Encrypt –∑–∞–ø–æ–ª–Ω–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    ssl_certificate /etc/letsencrypt/live/centerai.tech/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/centerai.tech/privkey.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # Frontend
    root /var/www/frontend/dist;
    index index.html;
    
    # API routes
    location /api/track-visit { proxy_pass http://backend_track_visit; }
    location /api/get-analytics { proxy_pass http://backend_get_analytics; }
    location /api/seo-analyze { proxy_pass http://backend_seo_analyze; }
    location /api/seo-apply { proxy_pass http://backend_seo_apply; }
    location /api/bot-logger { proxy_pass http://backend_bot_logger; }
    location /api/bot-stats { proxy_pass http://backend_bot_stats; }
    location /api/password-manager { proxy_pass http://backend_password_manager; }
    location /api/upload-image { 
        proxy_pass http://backend_upload_image;
        client_max_body_size 10M;
    }
    location /api/brief-handler { proxy_pass http://backend_brief_handler; }
    location /api/secure-settings { proxy_pass http://backend_secure_settings; }
    location /api/contact-form { proxy_pass http://backend_contact_form; }
    location /api/services-admin { proxy_pass http://backend_services_admin; }
    location /api/yandex-metrika-stats { proxy_pass http://backend_yandex_metrika; }
    location /api/yandex-webmaster-issues { proxy_pass http://backend_yandex_webmaster; }
    location /api/portfolio { proxy_pass http://backend_portfolio; }
    location /api/admin-partner-logos { proxy_pass http://backend_partner_logos; }
    location /api/partners { proxy_pass http://backend_partners; }
    location /api/partner-auth { proxy_pass http://backend_partner_auth; }
    location /api/submit-order { proxy_pass http://backend_submit_order; }
    location /api/admin-login-logs { proxy_pass http://backend_admin_logs; }
    location /api/auth-admin { proxy_pass http://backend_auth_admin; }
    location /api/consent { proxy_pass http://backend_consent; }
    location /api/news-feed { proxy_pass http://backend_news_feed; }
    
    # Frontend routing
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # Static caching
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è
sudo ln -s /etc/nginx/sites-available/centerai.tech /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –°–æ–∑–¥–∞—Ç—å `.env` –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
```bash
# /var/www/backend/track-visit/.env
DATABASE_URL=postgresql://centerai_user:password@localhost:5432/centerai_db
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
S3_BUCKET_NAME=files
S3_ENDPOINT_URL=https://storage.yandexcloud.net
S3_REGION=ru-central1
ADMIN_PASSWORD_HASH=$2b$12$...
ENCRYPTION_KEY=your_encryption_key_base64
BITRIX24_WEBHOOK_URL=https://your-domain.bitrix24.ru/rest/1/webhook/
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
OPENAI_API_KEY=your_openai_key
OPENAI_API_BASE=https://api.openai.com/v1
```

#### –°–∫—Ä–∏–ø—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è .env:
```bash
#!/bin/bash
# copy_env_to_all.sh

ENV_TEMPLATE="/var/www/backend/.env.template"

for dir in /var/www/backend/*/; do
  if [ -f "$dir/index.py" ]; then
    cp "$ENV_TEMPLATE" "$dir/.env"
    chmod 600 "$dir/.env"
    chown www-data:www-data "$dir/.env"
    echo "‚úÖ Copied .env to $dir"
  fi
done
```

---

### –®–∞–≥ 7: –î–µ–ø–ª–æ–π frontend

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –≤ –∫–æ–¥–µ:
```typescript
// src/config/api.ts
export const API_BASE_URL = 'https://centerai.tech/api';

export const API_ENDPOINTS = {
  trackVisit: `${API_BASE_URL}/track-visit`,
  getAnalytics: `${API_BASE_URL}/get-analytics`,
  seoAnalyze: `${API_BASE_URL}/seo-analyze`,
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ 21 —Ñ—É–Ω–∫—Ü–∏—è
};
```

#### –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π:
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
npm install
npm run build

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -r dist/* user@server:/var/www/frontend/dist/
```

---

### –®–∞–≥ 8: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å SSL –æ—Ç Let's Encrypt
sudo certbot --nginx -d centerai.tech -d www.centerai.tech

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
0 3 * * * /usr/bin/certbot renew --quiet
```

---

### –®–∞–≥ 9: Backup

#### Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
#!/bin/bash
# /usr/local/bin/backup_db.sh

BACKUP_DIR="/var/backups/postgresql"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

mkdir -p $BACKUP_DIR
pg_dump -U centerai_user centerai_db | gzip > "$BACKUP_DIR/backup_$TIMESTAMP.sql.gz"
find $BACKUP_DIR -name "backup_*.sql.gz" -mtime +7 -delete
```

```bash
# Crontab (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00)
0 2 * * * /usr/local/bin/backup_db.sh
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞

### –ß–µ–∫–ª–∏—Å—Ç:

- [ ] Frontend –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –¥–æ–º–µ–Ω—É
- [ ] SSL –∞–∫—Ç–∏–≤–µ–Ω (–∑–µ–ª–µ–Ω—ã–π –∑–∞–º–æ–∫)
- [ ] –í—Å–µ 24 backend —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–≤–µ—á–∞—é—Ç
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- [ ] S3 —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- [ ] –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- [ ] Bitrix24 –ø–æ–ª—É—á–∞–µ—Ç –∑–∞—è–≤–∫–∏
- [ ] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

### –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```bash
# 1. Track visit
curl -X POST https://centerai.tech/api/track-visit \
  -H "Content-Type: application/json" \
  -d '{"page":"/","referrer":"","userAgent":"test"}'

# 2. Contact form
curl -X POST https://centerai.tech/api/contact-form \
  -H "Content-Type: application/json" \
  -d '{"name":"Test","phone":"+79001234567","type":"contact_form"}'

# 3. Auth admin
curl -X POST https://centerai.tech/api/auth-admin \
  -H "Content-Type: application/json" \
  -d '{"password":"admin_password"}'
```

---

## üìä –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
- CPU: 2 cores
- RAM: 4GB
- Disk: 40GB SSD
- Bandwidth: 1TB/–º–µ—Å

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:
- CPU: 4 cores
- RAM: 8GB
- Disk: 100GB SSD
- Bandwidth: 2TB/–º–µ—Å

### –°—Ç–æ–∏–º–æ—Å—Ç—å —Ö–æ—Å—Ç–∏–Ω–≥–∞:
- VPS (Hetzner): ~‚Ç¨5-10/–º–µ—Å
- VPS (DigitalOcean): $12-24/–º–µ—Å
- VPS (–Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ): ‚ÇΩ1000-2000/–º–µ—Å

---

## üö® –í–∞–∂–Ω–æ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ –¢–æ–ª—å–∫–æ HTTPS
- ‚úÖ Firewall (ufw/iptables)
- ‚úÖ PostgreSQL —Ç–æ–ª—å–∫–æ localhost
- ‚úÖ –°–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log

# –õ–æ–≥–∏ backend
sudo journalctl -u backend-contact-form -f

# –õ–æ–≥–∏ PostgreSQL
sudo tail -f /var/log/postgresql/postgresql-13-main.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status backend-track-visit
```

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Nginx docs](https://nginx.org/ru/docs/)
- [PostgreSQL docs](https://postgrespro.ru/docs/postgresql)
- [Gunicorn deployment](https://docs.gunicorn.org/en/stable/deploy.html)
- [Let's Encrypt certbot](https://certbot.eff.org/)

---

**–ò—Ç–æ–≥–æ: 24 —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤—Å–µ, –≤—Ä–µ–º—è: ~4-8 —á–∞—Å–æ–≤**

–ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–Ω–æ—Å—É! üöÄ
